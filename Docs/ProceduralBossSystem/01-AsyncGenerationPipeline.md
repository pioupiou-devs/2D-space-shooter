# ?? Async Generation Pipeline

## Overview

The generation pipeline ensures **zero frame drops** by generating the next wave's content while the player is engaged with the current wave. This is achieved through Unity's **Job System** and **Burst Compiler**.

---

## ?? Core Principle: Pre-Generation

```
???????????????????????????????????????????????????????????????????????????????
?                      PARALLEL GENERATION TIMELINE                           ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  MAIN THREAD (Gameplay)                                                     ?
?  ????????????????????????????????????????????????????????????????????????   ?
?                                                                             ?
?  ??????????????? ??????????????? ??????????????? ???????????????            ?
?  ?  WAVE 1     ? ?  BOSS 1     ? ?  WAVE 2     ? ?  BOSS 2     ?            ?
?  ?  Encounter  ? ?  Fight      ? ?  Encounter  ? ?  Fight      ?            ?
?  ??????????????? ??????????????? ??????????????? ???????????????            ?
?       30s            45s             30s            45s                     ?
?                                                                             ?
?  JOB THREADS (Background Generation)                                        ?
?  ????????????????????????????????????????????????????????????????????????   ?
?                                                                             ?
?  ???Gen Theme 2???                 ???Gen Theme 3???                        ?
?  ???Gen Enemies???                 ???Gen Enemies???                        ?
?  ???Gen Boss 2????                 ???Gen Boss 3????                        ?
?  ???Gen Music?????                 ???Gen Music?????                        ?
?       ~5s                               ~5s                                 ?
?                                                                             ?
?  RESULT: Next content ready 25+ seconds before needed!                      ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

## ?? Generation Pipeline Architecture

```
???????????????????????????????????????????????????????????????????????????????
?                        GENERATION PIPELINE FLOW                             ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?                    ???????????????????????????                              ?
?                    ?   GenerationPipeline    ?                              ?
?                    ?   (Main Orchestrator)   ?                              ?
?                    ???????????????????????????                              ?
?                                ?                                            ?
?              ?????????????????????????????????????                          ?
?              ?                 ?                 ?                          ?
?              ?                 ?                 ?                          ?
?    ??????????????????? ??????????????????? ???????????????????              ?
?    ? ThemeGenJob     ? ? ContentGenJob   ? ? AudioGenJob     ?              ?
?    ? (IJob + Burst)  ? ? (IJobParallel   ? ? (IJob)          ?              ?
?    ?                 ? ?  For + Burst)   ? ?                 ?              ?
?    ??????????????????? ??????????????????? ???????????????????              ?
?             ?                   ?                   ?                       ?
?             ?    ???????????????????????????????    ?                       ?
?             ?    ?                             ?    ?                       ?
?             ?    ?                             ?    ?                       ?
?    ???????????????????                 ???????????????????                  ?
?    ? ThemeData       ?                 ? AudioParams     ?                  ?
?    ? (NativeArrays)  ?                 ? (NativeArrays)  ?                  ?
?    ???????????????????                 ???????????????????                  ?
?             ?                                   ?                           ?
?             ?????????????????????????????????????                           ?
?                             ?                                               ?
?                             ?                                               ?
?                    ???????????????????????????                              ?
?                    ?   GenerationCache       ?                              ?
?                    ?   (Ready for next wave) ?                              ?
?                    ???????????????????????????                              ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

## ?? Job Dependency Chain

```
???????????????????????????????????????????????????????????????????????????????
?                         JOB SCHEDULING ORDER                                ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?   FRAME N: Start Generation                                                 ?
?   ?????????????????????????????                                             ?
?                                                                             ?
?   ????????????????????                                                      ?
?   ? ThemeGenJob      ???? Runs FIRST (no dependencies)                      ?
?   ? (IJob + Burst)   ?    Generates: colors, music scale, shape style       ?
?   ????????????????????                                                      ?
?            ?                                                                ?
?            ? dependency                                                     ?
?            ?                                                                ?
?   ????????????????????  ????????????????????  ????????????????????          ?
?   ? EnemyGenJob      ?  ? BossGenJob       ?  ? MusicGenJob      ?          ?
?   ? (IJobParallelFor)?  ? (IJobParallelFor)?  ? (IJob)           ?          ?
?   ?                  ?  ?                  ?  ?                  ?          ?
?   ? 6 enemy types    ?  ? 8 hitboxes       ?  ? 4 tracks         ?          ?
?   ? in parallel      ?  ? in parallel      ?  ? sequential       ?          ?
?   ????????????????????  ????????????????????  ????????????????????          ?
?            ?                     ?                     ?                    ?
?            ?????????????????????????????????????????????                    ?
?                       ?                     ?                               ?
?                       ?                     ?                               ?
?              ???????????????????????????????????????                        ?
?              ? CombineDependencies                 ?                        ?
?              ? (Wait for ALL jobs to complete)     ?                        ?
?              ???????????????????????????????????????                        ?
?                                                                             ?
?   FRAME N+1 to N+X: Jobs running in background                              ?
?   ????????????????????????????????????????????????                          ?
?   Main thread continues gameplay, checks IsCompleted                        ?
?                                                                             ?
?   FRAME N+X: Jobs Complete                                                  ?
?   ?????????????????????????                                                 ?
?              ???????????????????????????????????????                        ?
?              ? Complete() + Build Cache            ?                        ?
?              ? Copy NativeArrays ? Managed Data    ?                        ?
?              ???????????????????????????????????????                        ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

## ?? Native Data Layout

```
???????????????????????????????????????????????????????????????????????????????
?                      NATIVE ARRAY DATA STRUCTURES                           ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  THEME COLOR DATA (NativeArray<float>, size: 20)                            ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ? Index:  0    1    2    3  ?  4    5    6    7  ?  8    9   10   11  ?    ?
?  ?         R    G    B    A  ?  R    G    B    A  ?  R    G    B    A  ?    ?
?  ?         ??????????????????????????????????????????????????????????  ?    ?
?  ?         PRIMARY COLOR     ? SECONDARY COLOR  ? ACCENT COLOR        ?    ?
?  ????????????????????????????????????????????????????????????????????  ?    ?
?  ? Index: 12   13   14   15  ? 16   17   18   19 ?                     ?    ?
?  ?         R    G    B    A  ?  R    G    B    A ?                     ?    ?
?  ?         ????????????????????????????????????  ?                     ?    ?
?  ?         BG DARK COLOR     ? BG LIGHT COLOR   ?                     ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
?  ENEMY SHAPE DATA (NativeArray<float>, size: 6 enemies × 64 floats)        ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                                                                     ?    ?
?  ?  ENEMY 0 (64 floats)              ENEMY 1 (64 floats)              ?    ?
?  ?  ???????????????????????????????  ???????????????????????????????  ?    ?
?  ?  ? [0-3]   Size (x,y,0,0)      ?  ? [0-3]   Size (x,y,0,0)      ?  ?    ?
?  ?  ? [4-7]   Color (r,g,b,a)     ?  ? [4-7]   Color (r,g,b,a)     ?  ?    ?
?  ?  ? [8-15]  SDF Params          ?  ? [8-15]  SDF Params          ?  ?    ?
?  ?  ? [16-19] Behavior            ?  ? [16-19] Behavior            ?  ?    ?
?  ?  ? [20-31] Hitboxes            ?  ? [20-31] Hitboxes            ?  ?    ?
?  ?  ? [32-47] Visual Details      ?  ? [32-47] Visual Details      ?  ?    ?
?  ?  ? [48-63] Reserved            ?  ? [48-63] Reserved            ?  ?    ?
?  ?  ???????????????????????????????  ???????????????????????????????  ?    ?
?  ?                                                                     ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
?  BOSS STRUCTURE DATA (NativeArray<float>, size: 8 hitboxes × 32 floats)    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                                                                     ?    ?
?  ?  HITBOX 0: CORE (32 floats)                                         ?    ?
?  ?  ???????????????????????????????????????????????????????????????    ?    ?
?  ?  ? [0-3]   Position (x,y,z,rotation)                           ?    ?    ?
?  ?  ? [4-7]   Size (w,h,0,0)                                      ?    ?    ?
?  ?  ? [8-11]  SDF Params (shape,radius,sides,0)                   ?    ?    ?
?  ?  ? [12-15] Stats (hp, dmgMult, isWeak, isActive)               ?    ?    ?
?  ?  ? [16-19] Color (r,g,b,a)                                     ?    ?    ?
?  ?  ? [20-23] Weapon (pattern, fireRate, speed, count)            ?    ?    ?
?  ?  ? [24-27] Phase Activation (p1, p2, p3, p4)                   ?    ?    ?
?  ?  ? [28-31] Relationships (parent, child1, child2, child3)      ?    ?    ?
?  ?  ???????????????????????????????????????????????????????????????    ?    ?
?  ?                                                                     ?    ?
?  ?  HITBOX 1: LEFT ARM    HITBOX 2: RIGHT ARM    HITBOX 3: HEAD       ?    ?
?  ?  ????????????????????  ????????????????????   ???????????????????? ?    ?
?  ?  ? ... 32 floats .. ?  ? ... 32 floats .. ?   ? ... 32 floats .. ? ?    ?
?  ?  ????????????????????  ????????????????????   ???????????????????? ?    ?
?  ?                                                                     ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
?  MUSIC SEQUENCE DATA (NativeArray<float>, size: 256 steps × 4 tracks)      ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                                                                     ?    ?
?  ?  Step:    0    1    2    3    4    5    6    7   ...  255           ?    ?
?  ?  ?????????????????????????????????????????????????????????          ?    ?
?  ?  Bass:   36    0    0    0   43    0    0    0   ...   36           ?    ?
?  ?  Drums:   4    0    3    0    6    0    3    0   ...    4           ?    ?
?  ?  Lead:   60    0    0   64    0    0   67    0   ...   60           ?    ?
?  ?  Pad:    36   -1   -1   -1   -1   -1   -1   -1   ...   41           ?    ?
?  ?                                                                     ?    ?
?  ?  Values: MIDI note (0=rest, -1=sustain, 1-127=note)                 ?    ?
?  ?  Drums:  Bitfield (1=kick, 2=snare, 4=hihat)                        ?    ?
?  ?                                                                     ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

## ?? Theme Generation Job

```
???????????????????????????????????????????????????????????????????????????????
?                      THEME GENERATION ALGORITHM                             ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  INPUT: seed (int), difficulty (int)                                        ?
?                                                                             ?
?  STEP 1: Initialize Deterministic RNG                                       ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?  rng = new Random(seed)  ??? Same seed = Same results always        ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
?  STEP 2: Generate Base Hue                                                  ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                                                                     ?    ?
?  ?     0°        60°       120°      180°      240°      300°    360° ?    ?
?  ?     ?         ?         ?         ?         ?         ?         ?  ?    ?
?  ?     ?         ?         ?         ?         ?         ?         ?  ?    ?
?  ?   ???????????????????????????????????????????????????????????????? ?    ?
?  ?   RED    YELLOW   GREEN    CYAN    BLUE   MAGENTA   RED            ?    ?
?  ?                                                                     ?    ?
?  ?   baseHue = rng.NextFloat() × 360°                                  ?    ?
?  ?                                                                     ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
?  STEP 3: Select Color Harmony                                               ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                                                                     ?    ?
?  ?  COMPLEMENTARY         TRIADIC             ANALOGOUS                ?    ?
?  ?       ?                  ?                    ???                   ?    ?
?  ?      ? ?                ???                   ??                    ?    ?
?  ?     ?   ?              ? ? ?                 ?  ?                   ?    ?
?  ?    ???????            ???????               ?    ?                  ?    ?
?  ?   +180°              +120° +240°          +30° -30°                 ?    ?
?  ?                                                                     ?    ?
?  ?  SPLIT-COMPLEMENTARY                                                ?    ?
?  ?       ?                                                             ?    ?
?  ?      ? ?                                                            ?    ?
?  ?     ?   ?                                                           ?    ?
?  ?    ?     ?                                                          ?    ?
?  ?  +150° +210°                                                        ?    ?
?  ?                                                                     ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
?  STEP 4: Generate 5 Colors                                                  ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                                                                     ?    ?
?  ?  PRIMARY      SECONDARY    ACCENT       BG DARK      BG LIGHT      ?    ?
?  ?  ????????     ????????     ????????     ????????     ????????      ?    ?
?  ?  ????????     ????????     ????????     ????????     ????????      ?    ?
?  ?  ????????     ????????     ????????     ????????     ????????      ?    ?
?  ?  ????????     ????????     ????????     ????????     ????????      ?    ?
?  ?  Hue: base    Hue: +harm   Hue: +harm2  Hue: base    Hue: base     ?    ?
?  ?  Sat: 80%     Sat: 70%     Sat: 90%     Sat: 30%     Sat: 20%      ?    ?
?  ?  Val: 90%     Val: 80%     Val: 100%    Val: 10%     Val: 20%      ?    ?
?  ?                                                                     ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
?  STEP 5: Difficulty Adjustment                                              ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                                                                     ?    ?
?  ?  Difficulty 1:  ??????????  Low saturation, muted                   ?    ?
?  ?  Difficulty 5:  ??????????  Medium saturation                       ?    ?
?  ?  Difficulty 10: ??????????  High saturation, vibrant                ?    ?
?  ?                                                                     ?    ?
?  ?  Higher difficulty = More intense colors, higher contrast           ?    ?
?  ?                                                                     ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
?  OUTPUT: NativeArray<float> with 5 colors (20 floats: 5 × RGBA)            ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

## ?? Enemy Generation Job

```
???????????????????????????????????????????????????????????????????????????????
?                      ENEMY GENERATION (PARALLEL)                            ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  IJobParallelFor: Each enemy type generated on separate thread              ?
?                                                                             ?
?  ???????????? ???????????? ???????????? ???????????? ???????????? ???????????
?  ? Thread 0 ? ? Thread 1 ? ? Thread 2 ? ? Thread 3 ? ? Thread 4 ? ?Thread 5??
?  ? FODDER   ? ? SHOOTER  ? ? DIVER    ? ? WEAVER   ? ? TANK     ? ?CARRIER ??
?  ???????????? ???????????? ???????????? ???????????? ???????????? ???????????
?       ?            ?            ?            ?            ?            ?    ?
?       ?            ?            ?            ?            ?            ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                     SHARED OUTPUT ARRAY                             ?    ?
?  ?  [Enemy0: 64 floats][Enemy1: 64 floats][...][Enemy5: 64 floats]    ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  ENEMY TYPE CHARACTERISTICS                                                 ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                                                                     ?    ?
?  ?  FODDER          SHOOTER         DIVER           WEAVER            ?    ?
?  ?    ??              ????           ??               ??              ?    ?
?  ?    ??              ????           ????             ????             ?    ?
?  ?    ??              ????           ??               ??              ?    ?
?  ?                                                                     ?    ?
?  ?  Size: 0.3       Size: 0.5      Size: 0.4       Size: 0.4          ?    ?
?  ?  HP: 1           HP: 2          HP: 2           HP: 3              ?    ?
?  ?  Speed: Fast     Speed: Med     Speed: V.Fast   Speed: Med         ?    ?
?  ?  Attack: None    Attack: Shoot  Attack: None    Attack: None       ?    ?
?  ?  Move: Straight  Move: Stop&Go  Move: Dive      Move: Sine Wave    ?    ?
?  ?                                                                     ?    ?
?  ?  TANK            CARRIER                                            ?    ?
?  ?  ??????          ????????                                           ?    ?
?  ?  ????????        ? ???? ?  ??? Spawns smaller enemies              ?    ?
?  ?  ??????          ????????                                           ?    ?
?  ?                                                                     ?    ?
?  ?  Size: 0.8       Size: 0.7                                          ?    ?
?  ?  HP: 10          HP: 8                                              ?    ?
?  ?  Speed: Slow     Speed: Slow                                        ?    ?
?  ?  Attack: Spread  Attack: None                                       ?    ?
?  ?  Move: Slow      Move: Slow                                         ?    ?
?  ?                                                                     ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  PER-ENEMY DATA GENERATION (64 floats)                                     ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                                                                     ?    ?
?  ?  1. SIZE (from type + random variation ±5%)                         ?    ?
?  ?     ??????                                                          ?    ?
?  ?     ?    ?  width = baseSize × (0.95 to 1.05)                       ?    ?
?  ?     ?    ?  height = baseSize × aspectRatio                         ?    ?
?  ?     ??????                                                          ?    ?
?  ?                                                                     ?    ?
?  ?  2. COLOR (from theme palette)                                      ?    ?
?  ?     Uses PRIMARY or SECONDARY color from theme                      ?    ?
?  ?                                                                     ?    ?
?  ?  3. SDF SHAPE PARAMS                                                ?    ?
?  ?     ???????????????????????????????????????????????????????????     ?    ?
?  ?     ? shapeType: 0=circle, 1=box, 2=triangle, 3=polygon, 4=star?    ?    ?
?  ?     ? cornerRadius: 0.1 to 0.3                                 ?     ?    ?
?  ?     ? polygonSides: 3 to 8                                     ?     ?    ?
?  ?     ? noiseAmount: 0 to 1 (organic distortion)                 ?     ?    ?
?  ?     ? rotation: 0 to 2?                                        ?     ?    ?
?  ?     ? symmetry: 0=none, 1=X-mirror                             ?     ?    ?
?  ?     ???????????????????????????????????????????????????????????     ?    ?
?  ?                                                                     ?    ?
?  ?  4. BEHAVIOR PARAMS (scaled by difficulty)                          ?    ?
?  ?     speed = baseSpeed × (1 + difficulty × 0.1)                      ?    ?
?  ?     hp = baseHP × (1 + difficulty × 0.1)                            ?    ?
?  ?     damage = 10 × (1 + difficulty × 0.1)                            ?    ?
?  ?     fireRate = baseRate × (1 + difficulty × 0.1)                    ?    ?
?  ?                                                                     ?    ?
?  ?  5. HITBOX DATA                                                     ?    ?
?  ?     Main hitbox + optional secondary (wings for Tank/Carrier)       ?    ?
?  ?                                                                     ?    ?
?  ?  6. VISUAL DETAILS                                                  ?    ?
?  ?     glowIntensity, pulseSpeed, enginePosition, etc.                 ?    ?
?  ?                                                                     ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

## ?? Boss Generation Job

```
???????????????????????????????????????????????????????????????????????????????
?                       BOSS GENERATION (PARALLEL)                            ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  IJobParallelFor: Each hitbox generated on separate thread                  ?
?                                                                             ?
?  ???????????? ???????????? ???????????? ????????????                        ?
?  ? Thread 0 ? ? Thread 1 ? ? Thread 2 ? ? Thread 3 ?  ...                   ?
?  ?   CORE   ? ? LEFT ARM ? ?RIGHT ARM ? ?   HEAD   ?                        ?
?  ???????????? ???????????? ???????????? ????????????                        ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  BOSS STRUCTURE (Generated Hitbox Layout)                                   ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                                                                     ?    ?
?  ?                      ???????????                                    ?    ?
?  ?                      ?  HEAD   ???? Hitbox 3 (revealed Phase 2+)    ?    ?
?  ?                      ? (weak)  ?    damageMultiplier: 1.5×          ?    ?
?  ?                      ???????????                                    ?    ?
?  ?                           ?                                         ?    ?
?  ?              ???????????????????????????                            ?    ?
?  ?              ?                         ?                            ?    ?
?  ?         ???????????              ???????????                        ?    ?
?  ?         ?  CORE   ?              ?WEAKPOINT???? Hitbox 4            ?    ?
?  ?         ? (main)  ???? Hitbox 0  ? (2× dmg)?    Revealed Phase 3    ?    ?
?  ?         ???????????   Always on  ???????????                        ?    ?
?  ?              ?                                                      ?    ?
?  ?     ???????????????????                                             ?    ?
?  ?     ?                 ?                                             ?    ?
?  ? ?????????         ?????????                                         ?    ?
?  ? ?LEFT   ?         ?RIGHT  ???? Hitboxes 1,2                         ?    ?
?  ? ? ARM   ?         ? ARM   ?    Active Phase 1 only                  ?    ?
?  ? ?[gun]  ?         ?[gun]  ?    Has weapon attachment                ?    ?
?  ? ?????????         ?????????                                         ?    ?
?  ?                                                                     ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  HITBOX ROLE ASSIGNMENT                                                     ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                                                                     ?    ?
?  ?  Index ? Role       ? Position        ? Active Phases ? Has Weapon ?    ?
?  ?  ???????????????????????????????????????????????????????????????????    ?
?  ?    0   ? CORE       ? (0, 0)          ? 1, 2, 3, 4    ? Yes        ?    ?
?  ?    1   ? LEFT ARM   ? (-0.8, -0.3)    ? 1 only        ? Yes        ?    ?
?  ?    2   ? RIGHT ARM  ? (+0.8, -0.3)    ? 1 only        ? Yes        ?    ?
?  ?    3   ? HEAD       ? (0, +0.6)       ? 2, 3, 4       ? No         ?    ?
?  ?    4   ? WEAK POINT ? (0, +0.3)       ? 3, 4          ? No         ?    ?
?  ?    5   ? TURRET     ? varies          ? 1, 2, 3, 4    ? Yes        ?    ?
?  ?    6   ? SHIELD     ? (0, 0) front    ? 1, 2          ? No         ?    ?
?  ?    7   ? TURRET 2   ? varies          ? 1, 2, 3, 4    ? Yes        ?    ?
?  ?                                                                     ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  DIFFICULTY SCALING                                                         ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                                                                     ?    ?
?  ?  Difficulty 1:   ???????                                            ?    ?
?  ?                  ?CORE ?  2 hitboxes, simple patterns               ?    ?
?  ?                  ???????                                            ?    ?
?  ?                                                                     ?    ?
?  ?  Difficulty 3:   ????? ??????? ?????                                ?    ?
?  ?                  ?ARM? ?CORE ? ?ARM?  4 hitboxes, more patterns     ?    ?
?  ?                  ????? ??????? ?????                                ?    ?
?  ?                                                                     ?    ?
?  ?  Difficulty 7:      ?????                                           ?    ?
?  ?                  ????WKP????                                        ?    ?
?  ?                  ?  ?????  ?   6 hitboxes, complex patterns         ?    ?
?  ?                ?????   ?????                                        ?    ?
?  ?                ?ARM?   ?ARM?                                        ?    ?
?  ?                ?????   ?????                                        ?    ?
?  ?                                                                     ?    ?
?  ?  Active Hitboxes = 2 + (difficulty / 2), max 6                      ?    ?
?  ?  Total HP = baseHP × (1 + difficulty × 0.15)                        ?    ?
?  ?  Fire Rate = baseRate × (1 + difficulty × 0.1)                      ?    ?
?  ?                                                                     ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

## ?? Music Generation Job

```
???????????????????????????????????????????????????????????????????????????????
?                       MUSIC SEQUENCE GENERATION                             ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  OUTPUT: 4 tracks × 256 steps (16 bars × 16 steps per bar)                 ?
?                                                                             ?
?  STEP 1: Select Scale Based on Seed                                        ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                                                                     ?    ?
?  ?  MINOR (Tense)           PHRYGIAN (Dark)         DORIAN (Mysterious)?    ?
?  ?  ???????????????         ???????????????         ???????????????   ?    ?
?  ?  ?C? ?D?D#? ?F? ?G?G#? ?A#?  ?C?C#? ?D#? ?F? ?G?G#? ?A#?  ?C? ?D?D#? ?F? ?G? ?A?A#?   ?    ?
?  ?  ???????????????         ???????????????         ???????????????   ?    ?
?  ?  Intervals:               Intervals:              Intervals:        ?    ?
?  ?  0,2,3,5,7,8,10           0,1,3,5,7,8,10          0,2,3,5,7,9,10    ?    ?
?  ?                                                                     ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
?  STEP 2: Select Root Note                                                   ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                                                                     ?    ?
?  ?  MIDI Range: 36 (C2) to 48 (C3)                                     ?    ?
?  ?                                                                     ?    ?
?  ?  Bass sits in low register for impact                               ?    ?
?  ?  Lead plays 1-2 octaves higher                                      ?    ?
?  ?                                                                     ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
?  STEP 3: Generate 4 Tracks                                                  ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                                                                     ?    ?
?  ?  BASS TRACK (rhythmic foundation)                                   ?    ?
?  ?  ???????????????????????????????????????????????????????????????    ?    ?
?  ?  ? Step: 1  2  3  4  5  6  7  8  9  10 11 12 13 14 15 16       ?    ?    ?
?  ?  ?       ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?        ?    ?    ?
?  ?  ?       ?           ?           ?           ?                  ?    ?    ?
?  ?  ?      Root       Fifth       Root       Fifth                 ?    ?    ?
?  ?  ?                                                              ?    ?    ?
?  ?  ?  Pattern: Root on 1, Fifth on 5 (or Root), repeat            ?    ?    ?
?  ?  ???????????????????????????????????????????????????????????????    ?    ?
?  ?                                                                     ?    ?
?  ?  DRUM TRACK (bitfield encoding)                                     ?    ?
?  ?  ???????????????????????????????????????????????????????????????    ?    ?
?  ?  ? Step: 1  2  3  4  5  6  7  8  9  10 11 12 13 14 15 16       ?    ?    ?
?  ?  ? Kick: X  ?  ?  ?  ?  ?  ?  ?  X  ?  ?  ?  ?  ?  ?  ?        ?    ?    ?
?  ?  ? Snr:  ?  ?  ?  ?  X  ?  ?  ?  ?  ?  ?  ?  X  ?  ?  ?        ?    ?    ?
?  ?  ? Hat:  X  ?  X  ?  X  ?  X  ?  X  ?  X  ?  X  ?  X  ?        ?    ?    ?
?  ?  ?       ?????????????????????????????????????????????          ?    ?    ?
?  ?  ? Value:5  0  4  0  6  0  4  0  5  0  4  0  6  0  4  0        ?    ?    ?
?  ?  ?                                                              ?    ?    ?
?  ?  ?  Encoding: Kick=1, Snare=2, HiHat=4 (additive)               ?    ?    ?
?  ?  ???????????????????????????????????????????????????????????????    ?    ?
?  ?                                                                     ?    ?
?  ?  LEAD TRACK (melodic variation)                                     ?    ?
?  ?  ???????????????????????????????????????????????????????????????    ?    ?
?  ?  ? Step: 1  2  3  4  5  6  7  8  9  10 11 12 13 14 15 16       ?    ?    ?
?  ?  ?       ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?        ?    ?    ?
?  ?  ?       ?        ?        ?        ?        ?     ?            ?    ?    ?
?  ?  ?      C4      E4       G4       A4       C5    B4            ?    ?    ?
?  ?  ?                                                              ?    ?    ?
?  ?  ?  Notes chosen from scale, slight randomness                  ?    ?    ?
?  ?  ?  Occasional octave jumps for interest                        ?    ?    ?
?  ?  ???????????????????????????????????????????????????????????????    ?    ?
?  ?                                                                     ?    ?
?  ?  PAD TRACK (sustained chords)                                       ?    ?
?  ?  ???????????????????????????????????????????????????????????????    ?    ?
?  ?  ? Bar:     1              2              3              4     ?    ?    ?
?  ?  ?       ?????????????? ?????????????? ?????????????? ???????? ?    ?    ?
?  ?  ?       ?              ?              ?              ?        ?    ?    ?
?  ?  ?       i (Cm)         iv (Fm)        v (Gm)         III (Eb) ?    ?    ?
?  ?  ?                                                              ?    ?    ?
?  ?  ?  Chord changes every bar (root note stored, chord built)     ?    ?    ?
?  ?  ?  Value = -1 means "sustain previous"                         ?    ?    ?
?  ?  ???????????????????????????????????????????????????????????????    ?    ?
?  ?                                                                     ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

## ? Performance Characteristics

```
???????????????????????????????????????????????????????????????????????????????
?                      BURST COMPILATION BENEFITS                             ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  BEFORE BURST (Managed C#)          AFTER BURST (Native Code)               ?
?  ???????????????????????????        ???????????????????????????             ?
?  ? Theme Gen:    5.2 ms    ?        ? Theme Gen:    0.05 ms   ?  100× faster?
?  ? Enemy Gen:   12.4 ms    ?   ???  ? Enemy Gen:    0.12 ms   ?  100× faster?
?  ? Boss Gen:     8.7 ms    ?        ? Boss Gen:     0.09 ms   ?   95× faster?
?  ? Music Gen:    3.1 ms    ?        ? Music Gen:    0.04 ms   ?   77× faster?
?  ???????????????????????????        ???????????????????????????             ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  MEMORY STRATEGY                                                            ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                                                                     ?    ?
?  ?  ? NativeArrays allocated ONCE at startup (Allocator.Persistent)   ?    ?
?  ?  ? Reused for each generation cycle                                 ?    ?
?  ?  ? No per-frame allocations                                         ?    ?
?  ?  ? Zero garbage collection during gameplay                          ?    ?
?  ?                                                                     ?    ?
?  ?  Startup Allocation:                                                ?    ?
?  ?  ?? themeColorData:     80 bytes (20 floats)                        ?    ?
?  ?  ?? enemyShapeData:  1,536 bytes (6 × 64 floats)                    ?    ?
?  ?  ?? bossStructureData: 1,024 bytes (8 × 32 floats)                  ?    ?
?  ?  ?? musicSequenceData: 4,096 bytes (256 × 4 floats)                 ?    ?
?  ?  ?????????????????????????????????????????????????                  ?    ?
?  ?  TOTAL: ~6.7 KB persistent allocation                               ?    ?
?  ?                                                                     ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  PARALLELISM                                                                ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                                                                     ?    ?
?  ?  8-core CPU Example:                                                ?    ?
?  ?                                                                     ?    ?
?  ?  Core 0: ???????? Main Thread (gameplay)                            ?    ?
?  ?  Core 1: ???????? ThemeJob (quick)                                  ?    ?
?  ?  Core 2: ???????? EnemyJob[0-2]                                     ?    ?
?  ?  Core 3: ???????? EnemyJob[3-5]                                     ?    ?
?  ?  Core 4: ???????? BossJob[0-3]                                      ?    ?
?  ?  Core 5: ???????? BossJob[4-7]                                      ?    ?
?  ?  Core 6: ???????? MusicJob                                          ?    ?
?  ?  Core 7: ???????? (available for Unity systems)                     ?    ?
?  ?                                                                     ?    ?
?  ?  Total generation time: ~0.3ms (parallel) vs ~30ms (sequential)     ?    ?
?  ?                                                                     ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

## ?? Integration with Other Systems

```
???????????????????????????????????????????????????????????????????????????????
?                      SYSTEM INTEGRATION POINTS                              ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  ???????????????????????                                                    ?
?  ? GenerationPipeline  ?                                                    ?
?  ???????????????????????                                                    ?
?             ?                                                               ?
?             ? produces GenerationCache                                      ?
?             ?                                                               ?
?             ?                                                               ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                      GenerationCache                                ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?  ?                                                                     ?    ?
?  ?  ???????????????  ???????????????  ???????????????  ??????????????? ?    ?
?  ?  ? ThemeData   ?  ? EnemyData[] ?  ? BossData    ?  ? MusicData   ? ?    ?
?  ?  ???????????????  ???????????????  ???????????????  ??????????????? ?    ?
?  ?         ?                ?                ?                ?        ?    ?
?  ???????????????????????????????????????????????????????????????????????    ?
?            ?                ?                ?                ?             ?
?            ?                ?                ?                ?             ?
?  ????????????????  ????????????????  ????????????????  ????????????????     ?
?  ?   VISUALS    ?  ?  ENCOUNTER   ?  ?    BOSS      ?  ?    AUDIO     ?     ?
?  ?   SYSTEM     ?  ?   SYSTEM     ?  ?   SYSTEM     ?  ?   SYSTEM     ?     ?
?  ????????????????  ????????????????  ????????????????  ????????????????     ?
?  ? • Background ?  ? • EnemySpawn ?  ? • BossSpawn  ?  ? • MusicSynth ?     ?
?  ?   Shaders    ?  ? • Formations ?  ? • Hitboxes   ?  ? • SFX        ?     ?
?  ? • VFX Colors ?  ? • Obstacles  ?  ? • Phases     ?  ? • Sequencer  ?     ?
?  ? • Materials  ?  ? • Behaviors  ?  ? • Weapons    ?  ?              ?     ?
?  ????????????????  ????????????????  ????????????????  ????????????????     ?
?                                                                             ?
?  See: 02-ProceduralVisuals.md, 03-ProceduralAudio.md, 04-ContentGeneration.md?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

*Next: [02-ProceduralVisuals.md](02-ProceduralVisuals.md) - GPU-based visual generation*
