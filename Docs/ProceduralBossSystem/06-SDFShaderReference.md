# ?? SDF Shader Reference

## Overview

This document provides detailed **HLSL code references** for the Signed Distance Field (SDF) shaders used in the Procedural Boss System. All shapes are rendered on the GPU with no texture assets required.

---

## ?? SDF Shape Library (SDFShapes.hlsl)

```
???????????????????????????????????????????????????????????????????????????????
?                    SDF SHAPE FUNCTIONS REFERENCE                            ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  All functions take a point 'p' and return signed distance:                 ?
?  ?? Negative: Inside the shape                                              ?
?  ?? Zero: On the edge                                                       ?
?  ?? Positive: Outside the shape                                             ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

## ?? Basic Primitives

### Circle

```hlsl
// Circle SDF
// p: sample point
// r: radius
float sdCircle(float2 p, float r)
{
    return length(p) - r;
}
```

```
???????????????????????????????????????????????????????????????????????????????
?  CIRCLE VISUALIZATION                                                       ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?           r                                                                 ?
?       ????????                                                              ?
?       ????????                                                              ?
?     ??????????????                                                          ?
?    ????????????????                                                         ?
?   ??????????????????                                                        ?
?   ???????[0]????????  ? center at (0,0)                                     ?
?   ??????????????????                                                        ?
?    ????????????????                                                         ?
?     ??????????????                                                          ?
?       ????????                                                              ?
?                                                                             ?
?  Usage: Enemy cores, bullets, powerup icons                                 ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

### Box

```hlsl
// Box SDF
// p: sample point
// b: half-extents (width/2, height/2)
float sdBox(float2 p, float2 b)
{
    float2 d = abs(p) - b;
    return length(max(d, 0.0)) + min(max(d.x, d.y), 0.0);
}
```

```
???????????????????????????????????????????????????????????????????????????????
?  BOX VISUALIZATION                                                          ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?       b.x                                                                   ?
?    ????????                                                                 ?
?    ????????????????  ?                                                      ?
?    ????????????????  ?                                                      ?
?    ????????????????  ? b.y                                                  ?
?    ????????[0]?????? ?                                                      ?
?    ????????????????  ?                                                      ?
?    ????????????????  ?                                                      ?
?                                                                             ?
?  Usage: Tank bodies, obstacles, UI elements                                 ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

### Rounded Box

```hlsl
// Rounded Box SDF
// p: sample point
// b: half-extents
// r: corner radius
float sdRoundBox(float2 p, float2 b, float r)
{
    float2 q = abs(p) - b + r;
    return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - r;
}
```

```
???????????????????????????????????????????????????????????????????????????????
?  ROUNDED BOX VISUALIZATION                                                  ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?      ??????????????                                                         ?
?    ????????????????????                                                     ?
?    ??????????????????????                                                   ?
?    ??????????????????????   r = corner radius                               ?
?    ??????????????????????                                                   ?
?    ????????????????????                                                     ?
?      ??????????????                                                         ?
?                                                                             ?
?  Usage: Enemy ships, boss hitboxes, buttons                                 ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

### Triangle (Equilateral)

```hlsl
// Equilateral Triangle SDF
// p: sample point
// r: radius (center to vertex)
float sdTriangle(float2 p, float r)
{
    const float k = sqrt(3.0);
    p.x = abs(p.x) - r;
    p.y = p.y + r / k;
    if (p.x + k * p.y > 0.0) 
        p = float2(p.x - k * p.y, -k * p.x - p.y) / 2.0;
    p.x -= clamp(p.x, -2.0 * r, 0.0);
    return -length(p) * sign(p.y);
}
```

```
???????????????????????????????????????????????????????????????????????????????
?  TRIANGLE VISUALIZATION                                                     ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?            ??                                                               ?
?           ????                                                              ?
?          ??????                                                             ?
?         ????????                                                            ?
?        ??????????                                                           ?
?       ????????????                                                          ?
?      ??????????????                                                         ?
?     ????????????????                                                        ?
?                                                                             ?
?  Usage: Diver enemies (pointing down), arrow indicators                     ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

### N-sided Polygon

```hlsl
// Regular Polygon SDF
// p: sample point
// r: radius
// n: number of sides
float sdPolygon(float2 p, float r, int n)
{
    float an = 3.141593 / float(n);
    float2 acs = float2(cos(an), sin(an));
    
    float bn = fmod(atan2(p.x, p.y), 2.0 * an) - an;
    p = length(p) * float2(cos(bn), abs(sin(bn)));
    
    p -= r * acs;
    p.y += clamp(-p.y, 0.0, r * acs.y);
    
    return length(p) * sign(p.x);
}
```

```
???????????????????????????????????????????????????????????????????????????????
?  POLYGON EXAMPLES                                                           ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  n=5 (Pentagon)       n=6 (Hexagon)        n=8 (Octagon)                    ?
?                                                                             ?
?       ????                ????????            ????????????                  ?
?     ????????            ????????????        ??????????????????              ?
?    ??????????          ??????????????      ????????????????????             ?
?     ????????            ????????????        ??????????????????              ?
?       ????                ????????            ????????????                  ?
?                                                                             ?
?  Usage: Varied enemy shapes, boss components                                ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

### Star

```hlsl
// Star SDF
// p: sample point
// r: outer radius
// n: number of points
// m: inner radius ratio (0.0 - 1.0)
float sdStar(float2 p, float r, int n, float m)
{
    float an = 3.141593 / float(n);
    float en = 3.141593 / m;
    float2 acs = float2(cos(an), sin(an));
    float2 ecs = float2(cos(en), sin(en));
    
    float bn = fmod(atan2(p.x, p.y), 2.0 * an) - an;
    p = length(p) * float2(cos(bn), abs(sin(bn)));
    
    p -= r * acs;
    p += ecs * clamp(-dot(p, ecs), 0.0, r * acs.y / ecs.y);
    
    return length(p) * sign(p.x);
}
```

```
???????????????????????????????????????????????????????????????????????????????
?  STAR VISUALIZATION                                                         ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  n=5, m=2.5            n=4, m=3.0           n=6, m=2.0                      ?
?  (5-point star)        (4-point star)       (6-point star)                  ?
?                                                                             ?
?        ??                    ??                  ??                         ?
?       ????                  ????               ??????                       ?
?   ????????????          ????????????       ????????????????                 ?
?     ????????              ????????           ????????????                   ?
?    ??????????            ??????????         ??????????????                  ?
?   ????    ????          ????    ????       ????????????????                 ?
?  ??          ??        ??          ??         ??????                        ?
?                                                   ??                        ?
?                                                                             ?
?  Usage: Powerup icons, boss weak points, decorative elements                ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

## ?? Boolean Operations

### Union (OR)

```hlsl
// Union: combine two shapes
float opUnion(float d1, float d2)
{
    return min(d1, d2);
}
```

### Intersection (AND)

```hlsl
// Intersection: only where both shapes overlap
float opIntersection(float d1, float d2)
{
    return max(d1, d2);
}
```

### Subtraction (NOT)

```hlsl
// Subtraction: carve d2 from d1
float opSubtraction(float d1, float d2)
{
    return max(d1, -d2);
}
```

```
???????????????????????????????????????????????????????????????????????????????
?  BOOLEAN OPERATIONS                                                         ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  SHAPE A          SHAPE B          UNION            SUBTRACTION             ?
?                                                                             ?
?   ????????          ????????        ????????????      ????????              ?
?  ??????????        ??????????      ??????????????????????????????           ?
?  ??????????        ??????????      ????????????????????????????????         ?
?  ??????????        ??????????      ??????????????????????????????           ?
?   ????????          ????????        ????????????      ????  ????            ?
?                                                       ????    ??            ?
?                                                       ????  ????            ?
?                                                        ????????             ?
?                                                                             ?
?  min(A, B)                         max(A, -B)                               ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

### Smooth Boolean Operations

```hlsl
// Smooth Union: blend two shapes with smooth transition
float opSmoothUnion(float d1, float d2, float k)
{
    float h = clamp(0.5 + 0.5 * (d2 - d1) / k, 0.0, 1.0);
    return lerp(d2, d1, h) - k * h * (1.0 - h);
}

// Smooth Subtraction
float opSmoothSubtraction(float d1, float d2, float k)
{
    float h = clamp(0.5 - 0.5 * (d2 + d1) / k, 0.0, 1.0);
    return lerp(d1, -d2, h) + k * h * (1.0 - h);
}

// Smooth Intersection
float opSmoothIntersection(float d1, float d2, float k)
{
    float h = clamp(0.5 - 0.5 * (d2 - d1) / k, 0.0, 1.0);
    return lerp(d2, d1, h) + k * h * (1.0 - h);
}
```

```
???????????????????????????????????????????????????????????????????????????????
?  SMOOTH BLEND COMPARISON                                                    ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  HARD UNION (k=0)          SMOOTH UNION (k=0.3)                             ?
?                                                                             ?
?    ????????????                ??????????????                               ?
?  ??????????????????          ????????????????????                           ?
?  ????????????????????        ??????????????????????                         ?
?  ????????????????????        ????????????????????????                       ?
?    ??????????????????          ????????????????????                         ?
?      ??????????????              ????????????????                           ?
?        ????????                    ??????????                               ?
?                                                                             ?
?  Sharp corners                 Smooth, organic blend                        ?
?                                                                             ?
?  k = smoothing factor (0.0 = sharp, higher = smoother)                      ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

## ?? Transform Operations

### Rotation

```hlsl
// Rotate a point around origin
float2 rotate(float2 p, float angle)
{
    float s = sin(angle);
    float c = cos(angle);
    return float2(p.x * c - p.y * s, p.x * s + p.y * c);
}

// Usage in SDF:
// float d = sdBox(rotate(p - offset, angle), size);
```

### Translation

```hlsl
// Simply subtract offset from point
// float d = sdCircle(p - offset, radius);
```

### Symmetry

```hlsl
// Mirror across X axis
float2 mirrorX(float2 p)
{
    return float2(abs(p.x), p.y);
}

// Mirror across Y axis
float2 mirrorY(float2 p)
{
    return float2(p.x, abs(p.y));
}

// Mirror across both axes (4-way symmetry)
float2 mirror(float2 p)
{
    return abs(p);
}
```

```
???????????????????????????????????????????????????????????????????????????????
?  SYMMETRY OPERATIONS                                                        ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  ORIGINAL              MIRROR X              MIRROR XY                      ?
?                                                                             ?
?  ??????                ??????????????        ??????????????                 ?
?    ????                  ????????????          ????????                     ?
?      ??                    ????????            ????????                     ?
?                                                ????????                     ?
?                                              ????????????                   ?
?                                            ??????????????                   ?
?                                                                             ?
?  Use mirror operations to build symmetric ships from one side definition    ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

## ?? Rendering Functions

### Fill with Anti-aliasing

```hlsl
// Anti-aliased fill
float4 sdfFill(float d, float4 color, float smoothness)
{
    float alpha = 1.0 - smoothstep(-smoothness, smoothness, d);
    return float4(color.rgb, color.a * alpha);
}
```

### Outline

```hlsl
// Outline rendering
float4 sdfOutline(float d, float4 color, float width, float smoothness)
{
    float alpha = 1.0 - smoothstep(-smoothness, smoothness, abs(d) - width);
    return float4(color.rgb, color.a * alpha);
}
```

### Glow Effect

```hlsl
// Glow around shape
float4 sdfGlow(float d, float4 color, float glowRadius, float falloff)
{
    float glow = exp(-max(d, 0.0) * falloff);
    return float4(color.rgb, color.a * glow);
}
```

### Combined Rendering

```hlsl
// Complete sprite rendering with fill, outline, and glow
float4 renderSDFSprite(float d, 
                       float4 fillColor, 
                       float4 outlineColor, 
                       float4 glowColor,
                       float outlineWidth,
                       float glowRadius)
{
    float smoothness = fwidth(d);
    
    // Base fill
    float4 result = float4(0, 0, 0, 0);
    
    // Glow (behind everything)
    float glowAlpha = exp(-max(d, 0.0) * (1.0 / glowRadius));
    result = lerp(result, glowColor, glowAlpha * glowColor.a);
    
    // Outline
    float outlineAlpha = 1.0 - smoothstep(-smoothness, smoothness, abs(d) - outlineWidth);
    result = lerp(result, outlineColor, outlineAlpha * outlineColor.a);
    
    // Fill (on top)
    float fillAlpha = 1.0 - smoothstep(-smoothness, smoothness, d);
    result = lerp(result, fillColor, fillAlpha * fillColor.a);
    
    return result;
}
```

```
???????????????????????????????????????????????????????????????????????????????
?  RENDERING LAYERS                                                           ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  LAYER 1: GLOW           LAYER 2: OUTLINE      LAYER 3: FILL                ?
?  (furthest)                                    (closest)                    ?
?                                                                             ?
?    ???????????????         ??????????????         ????????????              ?
?  ???????????????????       ??          ??       ????????????????            ?
?  ???????????????????       ??          ??       ????????????????            ?
?  ???????????????????       ??          ??       ????????????????            ?
?    ???????????????         ??????????????         ????????????              ?
?                                                                             ?
?  Additive/alpha blend to create final sprite:                               ?
?                                                                             ?
?    ????????????????                                                         ?
?  ??????????????????????                                                     ?
?  ??????????????????????                                                     ?
?  ??????????????????????                                                     ?
?    ????????????????                                                         ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

## ?? Complex Ship Construction

### Enemy Ship Example

```hlsl
// Construct a complex enemy ship from primitives
float sdEnemyShip(float2 p, float bodySize, float wingSpan)
{
    // Use mirror for symmetry
    float2 mp = mirrorX(p);
    
    // Main body (rounded box)
    float body = sdRoundBox(p, float2(bodySize * 0.4, bodySize * 0.6), bodySize * 0.1);
    
    // Wings (triangles)
    float2 wingPos = float2(bodySize * 0.5, 0);
    float wing = sdTriangle(rotate(mp - wingPos, -0.5), bodySize * 0.3);
    
    // Cockpit (subtracted circle)
    float cockpit = sdCircle(p + float2(0, -bodySize * 0.2), bodySize * 0.15);
    
    // Engine (circle)
    float engine = sdCircle(p + float2(0, bodySize * 0.5), bodySize * 0.12);
    
    // Combine: body + wings - cockpit + engine
    float ship = opSmoothUnion(body, wing, 0.05);
    ship = opSubtraction(ship, cockpit);
    ship = opUnion(ship, engine);
    
    return ship;
}
```

```
???????????????????????????????????????????????????????????????????????????????
?  SHIP CONSTRUCTION BREAKDOWN                                                ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  1. BODY             2. +WINGS           3. -COCKPIT        4. +ENGINE      ?
?                                                                             ?
?    ????????            ????????            ????????            ????????     ?
?    ????????          ??????????????      ??????????????      ?????????????? ?
?    ????????        ????????????????????????    ??????????????    ?????????? ?
?    ????????          ??????????????      ??????????????      ?????????????? ?
?    ????????            ????????            ????????            ????????     ?
?                                                                ????         ?
?                                                                             ?
?  min(box)          +min(triangles)     -circle             +circle          ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

## ?? Theme Color Integration

```hlsl
// Theme color properties (set globally)
float4 _PrimaryColor;
float4 _SecondaryColor;
float4 _AccentColor;
float4 _BGDarkColor;
float4 _BGLightColor;

// Instance properties (per-object)
float _FlashIntensity;    // 0-1, for damage flash
float _DamageLevel;       // 0-1, for damage visualization

// Apply theme colors with effects
float4 applyThemeColors(float d, 
                        float isWeakPoint,    // 0 or 1
                        float isEngine)       // 0 or 1
{
    // Select base color
    float4 fillColor = lerp(_PrimaryColor, _AccentColor, isWeakPoint);
    fillColor = lerp(fillColor, _AccentColor, isEngine);
    
    // Outline always secondary
    float4 outlineColor = _SecondaryColor;
    
    // Glow is accent
    float4 glowColor = _AccentColor;
    
    // Apply damage flash (white overlay)
    float4 flashColor = float4(1, 1, 1, 1);
    fillColor = lerp(fillColor, flashColor, _FlashIntensity);
    
    // Render with all layers
    return renderSDFSprite(d, fillColor, outlineColor, glowColor, 0.02, 0.1);
}
```

---

## ? Performance Tips

```
???????????????????????????????????????????????????????????????????????????????
?                    SDF SHADER PERFORMANCE GUIDELINES                        ?
???????????????????????????????????????????????????????????????????????????????
?                                                                             ?
?  ? DO:                                                                      ?
?  ?? Use fwidth() for pixel-perfect anti-aliasing                            ?
?  ?? Limit SDF operations per shader (< 20 for complex shapes)               ?
?  ?? Use smoothUnion sparingly (more expensive)                              ?
?  ?? Pre-calculate sin/cos for static rotations                              ?
?  ?? Use symmetry operations to reduce calculations                          ?
?  ?? Early-out when distance is large (skip glow calculation)                ?
?                                                                             ?
?  ? DON'T:                                                                   ?
?  ?? Use loops in the fragment shader (unroll if needed)                     ?
?  ?? Branch on per-pixel values (use lerp instead)                           ?
?  ?? Calculate complex shapes when off-screen                                ?
?  ?? Use high smoothing values (k > 0.5) without need                        ?
?                                                                             ?
?  COMPLEXITY BUDGET:                                                         ?
?  ?? Simple enemy:  8 SDF operations max                                     ?
?  ?? Complex enemy: 16 SDF operations max                                    ?
?  ?? Boss hitbox:   24 SDF operations max                                    ?
?  ?? Background:    32 SDF operations (single fullscreen)                    ?
?                                                                             ?
???????????????????????????????????????????????????????????????????????????????
```

---

## ?? Shader Structure

### Complete SDF Sprite Shader

```hlsl
// SDFSprite.shader
Shader "Procedural/SDFSprite"
{
    Properties
    {
        _ShapeType ("Shape Type", Int) = 0
        _Size ("Size", Float) = 1.0
        _Params ("Shape Parameters", Vector) = (0,0,0,0)
        _OutlineWidth ("Outline Width", Float) = 0.02
        _GlowRadius ("Glow Radius", Float) = 0.1
    }
    
    SubShader
    {
        Tags { "RenderType"="Transparent" "Queue"="Transparent" }
        Blend SrcAlpha OneMinusSrcAlpha
        ZWrite Off
        Cull Off
        
        Pass
        {
            HLSLPROGRAM
            #pragma vertex vert
            #pragma fragment frag
            #pragma multi_compile_instancing
            
            #include "SDFShapes.hlsl"
            #include "ColorUtils.hlsl"
            
            // Global theme colors
            float4 _PrimaryColor;
            float4 _SecondaryColor;
            float4 _AccentColor;
            
            UNITY_INSTANCING_BUFFER_START(Props)
                UNITY_DEFINE_INSTANCED_PROP(float, _FlashIntensity)
                UNITY_DEFINE_INSTANCED_PROP(float, _DamageLevel)
            UNITY_INSTANCING_BUFFER_END(Props)
            
            struct appdata
            {
                float4 vertex : POSITION;
                float2 uv : TEXCOORD0;
                UNITY_VERTEX_INPUT_INSTANCE_ID
            };
            
            struct v2f
            {
                float4 pos : SV_POSITION;
                float2 uv : TEXCOORD0;
                UNITY_VERTEX_INPUT_INSTANCE_ID
            };
            
            v2f vert(appdata v)
            {
                v2f o;
                UNITY_SETUP_INSTANCE_ID(v);
                UNITY_TRANSFER_INSTANCE_ID(v, o);
                o.pos = UnityObjectToClipPos(v.vertex);
                o.uv = v.uv * 2.0 - 1.0; // Center UV
                return o;
            }
            
            float4 frag(v2f i) : SV_Target
            {
                UNITY_SETUP_INSTANCE_ID(i);
                
                // Calculate SDF based on shape type
                float d = sdEnemyShip(i.uv, _Size, _Params.x);
                
                // Get instance properties
                float flash = UNITY_ACCESS_INSTANCED_PROP(Props, _FlashIntensity);
                
                // Apply theme colors and render
                float4 col = applyThemeColors(d, 0, 0);
                
                // Apply flash
                col.rgb = lerp(col.rgb, float3(1,1,1), flash);
                
                return col;
            }
            ENDHLSL
        }
    }
}
```

---

*Previous: [05-ImplementationPhases.md](05-ImplementationPhases.md)*
*Next: [07-AudioSynthesisReference.md](07-AudioSynthesisReference.md) - DSP code reference*
*Back to: [README.md](README.md)*
